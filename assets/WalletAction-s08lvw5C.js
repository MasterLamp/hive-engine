import{x as se,s as oe,r as y,c as q,bj as le,G as re,P as L,H as ie,I as D,o as n,a as p,w as g,b as x,t as l,d as c,F as V,f as s,L as W,i as f,h as M,j as R,g as m,k as U,Q as j,v as C,e as ue,_ as de,bk as A,bl as H,bm as O,B as Q,bn as ce}from"./index-CCPLilNe.js";import{_ as E}from"./CustomTable-ruclgATk.js";const me=["onClick"],be=["onClick"],ve={key:1,class:"alert-warning font-bold"},ye={key:2,class:"mb-3"},fe={key:0,class:"mt-1 text-sm text-red-500"},ke={key:1,class:"mt-1 text-sm"},ge=["onClick"],qe={key:3,class:"mb-3"},xe={key:0,class:"mt-1 text-sm text-red-500"},pe={class:"mb-3"},we={class:"flex w-full items-center"},he={class:"h-full rounded-r-md border border-l-0 border-gray-500 bg-gray-200 p-2 dark:bg-slate-600"},Le={key:0,class:"mt-1 text-sm text-red-500"},Ue={key:4,class:"mb-3"},Ce=["disabled"],Ne={__name:"WalletAction",props:{action:{type:String,default:"transfer",required:!0},symbol:{type:String,required:!0},available:{type:[Object,String,Number],required:!0}},setup(o){const u=o,G=se(),k=oe(),$=y(!0),w=y(!1),d=y(""),b=y(""),i=y(""),h=y(""),P=y({}),T=y([]),Z=[{key:"to",label:"From"},{key:"quantity",label:"Amount"},{key:"actions",label:""}],S=y([]),J=[{key:"quantity",label:"Quantity"},{key:"quantityLeft",label:"Remaining"},{key:"nextTransactionTimestamp",label:"Next Withdrawal"},{key:"actions",label:""}],N=q(()=>G.username),K={to:{required:A,minLength:H(3),maxLength:O(16),validUsername:a=>a===""?!0:/^([a-z])[a-z0-9-.]*$/.test(a)},from:{required:A,minLength:H(3),maxLength:O(16),validUsername:a=>a===""?!0:/^([a-z])[a-z0-9-.]*$/.test(a)},quantity:{required:A,greaterThanZero:a=>a===""?!0:a>0}},X=q(()=>Object.keys({transfer:{to:d,quantity:i},delegate:{to:d,quantity:i},undelegate:{from:b,quantity:i},stake:{to:d,quantity:i},unstake:{quantity:i},pendingUnstakes:{}}[u.action]).reduce((e,v)=>(e[v]=K[v],e),{})),r=le(X,{to:d,from:b,quantity:i},{$externalResults:P}),F=q(()=>({transfer:"Transfer",delegate:"Delegate",undelegate:"Undelegate",stake:"Stake",unstake:"Unstake",pendingUnstakes:"Pending Unstakes"})[u.action]||""),I=q(()=>k.popularChoices(u.symbol)),Y=q(()=>["transfer","stake","delegate"].includes(u.action)),_=q(()=>["undelegate"].includes(u.action)),ee=async()=>{if(r.value.$clearExternalResults(),!!await r.value.$validate()&&(r.value.to||r.value.from)){const a=r.value.to?d.value:b.value,e=r.value.to?"to":"from";try{const[v]=await ce.getAccounts([a]);(!v||!v.name)&&(P.value={[e]:["Invalid hive username"]})}catch(v){console.log(v)}}},z=async()=>{await ee(),r.value.$invalid||await{transfer:k.requestTransfer,delegate:k.requestDelegate,undelegate:k.requestUndelegate,stake:k.requestStake,unstake:k.requestUnstake}[u.action]({symbol:u.symbol,to:d.value.trim(),from:b.value.trim(),quantity:i.value.toString(),memo:h.value.trim()})},te=async()=>{if($.value=!0,u.action==="stake")d.value=N.value;else if(u.action==="undelegate"){const a=await Q.contract({method:"find",params:{contract:"tokens",table:"delegations",query:{symbol:u.symbol,from:N.value}}});T.value=a.map(e=>({...e,quantity:Number(e.quantity)}))}else if(u.action==="pendingUnstakes"){const a=await Q.getPendingUnstakes(N.value,u.symbol);S.value=a.map(e=>({...e,quantity:Number(e.quantity),quantityLeft:Number(e.quantityLeft)}))}$.value=!1},ae=()=>{r.value.$reset(),d.value="",b.value="",i.value="",h.value="",T.value=[],S.value=[]};return re(()=>{L.on("broadcast-awaiting",()=>{w.value=!0}),L.on("broadcast-done",()=>{w.value=!1})}),ie(()=>{L.off("broadcast-awaiting"),L.off("broadcast-done")}),(a,e)=>{const v=D("Loading"),ne=D("Spinner");return n(),p(de,{"modal-id":"walletActionModal",onBeforeOpen:te,onClosed:ae},{title:g(()=>[x(l(F.value)+" "+l(o.symbol),1)]),default:g(()=>[$.value?(n(),p(v,{key:0,small:""})):(n(),c(V,{key:1},[o.action==="pendingUnstakes"?(n(),p(E,{key:0,items:S.value,fields:J},{"cell(quantity)":g(({item:t})=>[x(l(t.quantity)+" "+l(o.symbol),1)]),"cell(quantityLeft)":g(({item:t})=>[x(l(t.quantityLeft)+" "+l(o.symbol)+" ",1),s("small",null,"("+l(t.numberTransactionsLeft)+" Transactions)",1)]),"cell(nextTransactionTimestamp)":g(({item:t})=>[x(l(t.quantityLeft/t.numberTransactionsLeft)+" "+l(o.symbol)+" at "+l(new Date(t.nextTransactionTimestamp).toLocaleString()),1)]),"cell(actions)":g(({item:t})=>[s("button",{class:"btn-sm",onClick:W(B=>f(k).requestCancelUnstake({symbol:o.symbol,trxId:t.txID}),["prevent"])},[M(f(R),{class:"h-5 w-5"})],8,me)]),_:1},8,["items"])):(n(),c(V,{key:1},[o.action==="undelegate"?(n(),p(E,{key:0,fields:Z,items:T.value,class:"mb-5"},{"cell(actions)":g(({item:t})=>[s("button",{class:"btn-sm",onClick:W(B=>{i.value=t.quantity,b.value=t.to,z()},["prevent"])},[M(f(R),{class:"h-5 w-5"})],8,be)]),_:1},8,["items"])):m("",!0),o.symbol&&o.symbol.startsWith("SWAP.")?(n(),c("div",ve," If you are trying to withdraw to an external chain, please use the Withdraw menu. This window is for transferring to another Hive account. ")):m("",!0),e[12]||(e[12]=s("div",{class:"mb-2 block font-bold"},"Available",-1)),s("div",{class:"mb-4 cursor-pointer",onClick:e[0]||(e[0]=t=>i.value=o.available)},l(o.available)+" "+l(o.symbol),1),Y.value?(n(),c("div",ye,[e[8]||(e[8]=s("label",{for:"to",class:"mb-2 block font-bold"},"To",-1)),U(s("input",{id:"to","onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t),type:"text",class:j([f(r).to.$error?"border-red-500 focus:border-red-500 focus:ring-red-500 dark:border-red-500":"",""]),placeholder:"Hive username",onInput:e[2]||(e[2]=t=>d.value=t.target.value.toLowerCase())},null,34),[[C,d.value]]),f(r).to.$error?(n(),c("div",fe,"Please enter a valid hive username.")):m("",!0),I.value.length?(n(),c("div",ke,[e[7]||(e[7]=x(" Popular choice: ")),(n(!0),c(V,null,ue(I.value,(t,B)=>(n(),c("a",{key:B,class:"cursor-pointer",onClick:$e=>d.value=t.value},l(t.text),9,ge))),128))])):m("",!0)])):m("",!0),_.value?(n(),c("div",qe,[e[9]||(e[9]=s("label",{for:"from",class:"mb-2 block font-bold"},"From",-1)),U(s("input",{id:"from","onUpdate:modelValue":e[3]||(e[3]=t=>b.value=t),type:"text",class:j([f(r).from.$error?"border-red-500 focus:border-red-500 focus:ring-red-500 dark:border-red-500":"",""]),placeholder:"Hive username",onInput:e[4]||(e[4]=t=>b.value=t.target.value.toLowerCase())},null,34),[[C,b.value]]),f(r).from.$error?(n(),c("div",xe,"Please enter a valid hive username.")):m("",!0)])):m("",!0),s("div",pe,[e[10]||(e[10]=s("label",{for:"quantity",class:"mb-2 block font-bold"},"Quantity",-1)),s("div",we,[U(s("input",{id:"quantity","onUpdate:modelValue":e[5]||(e[5]=t=>i.value=t),type:"number",class:j([f(r).quantity.$error?"border-red-500 focus:border-red-500 focus:ring-red-500 dark:border-red-500":"","!rounded-r-none"]),placeholder:"Amount"},null,2),[[C,i.value]]),s("div",he,l(o.symbol),1)]),f(r).quantity.$error?(n(),c("div",Le," Please enter a quantity greater than zero. ")):m("",!0)]),o.action==="transfer"?(n(),c("div",Ue,[e[11]||(e[11]=s("label",{for:"memo",class:"mb-2 block font-bold"},"Memo",-1)),U(s("input",{id:"memo","onUpdate:modelValue":e[6]||(e[6]=t=>h.value=t),type:"text"},null,512),[[C,h.value]])])):m("",!0),s("button",{class:"btn",disabled:i.value>o.available||w.value,onClick:z},[w.value?(n(),p(ne,{key:0})):m("",!0),x(" "+l(" ")+" "+l(F.value),1)],8,Ce)],64))],64))]),_:1})}}};export{Ne as default};
