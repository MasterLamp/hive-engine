const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RenewLeaseModal-Dbj4J-lB.js","assets/index-CCPLilNe.js","assets/index-Rzzs60cW.css","assets/LoadingOverlay-CxOz52n3.js"])))=>i.map(i=>d[i]);
import{a8 as V,r as E,ae as ne,c as k,ab as G,a7 as ie,G as W,A as fe,bc as he,ad as P,ag as K,ah as ke,F as le,a9 as me,ai as ye,n as z,bd as we,be as ce,bf as se,aj as D,an as J,ak as Ie,al as N,am as $,U as Pe,K as Se,u as Le,x as Te,ba as Ae,bb as Ee,V as Fe,H as Ce,d as M,W as De,a as $e,f as S,k as de,b8 as ve,t as i,e as pe,i as x,h as L,w as r,o as R,Q as X,b as I,a6 as Y,y as H,L as Z,a2 as Oe,bg as Ue,a3 as Be,a4 as Re}from"./index-CCPLilNe.js";import{_ as ee}from"./CustomTable-ruclgATk.js";import{u as qe,f as xe,a as be}from"./addWeeks-KsHtYn1H.js";function Ne(a){typeof queueMicrotask=="function"?queueMicrotask(a):Promise.resolve().then(a).catch(_=>setTimeout(()=>{throw _}))}let Me=V({props:{onFocus:{type:Function,required:!0}},setup(a){let _=E(!0);return()=>_.value?ne(xe,{as:"button",type:"button",features:qe.Focusable,onFocus(f){f.preventDefault();let w,m=50;function b(){var n;if(m--<=0){w&&cancelAnimationFrame(w);return}if((n=a.onFocus)!=null&&n.call(a)){_.value=!1,cancelAnimationFrame(w);return}w=requestAnimationFrame(b)}w=requestAnimationFrame(b)}}):null}});var Ve=(a=>(a[a.Forwards=0]="Forwards",a[a.Backwards=1]="Backwards",a))(Ve||{}),je=(a=>(a[a.Less=-1]="Less",a[a.Equal=0]="Equal",a[a.Greater=1]="Greater",a))(je||{});let _e=Symbol("TabsContext");function Q(a){let _=z(_e,null);if(_===null){let f=new Error(`<${a} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(f,Q),f}return _}let ue=Symbol("TabsSSRContext"),Ge=V({name:"TabGroup",emits:{change:a=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(a,{slots:_,attrs:f,emit:w}){var m;let b=E((m=a.selectedIndex)!=null?m:a.defaultIndex),n=E([]),d=E([]),u=k(()=>a.selectedIndex!==null),c=k(()=>u.value?a.selectedIndex:b.value);function o(s){var v;let y=G(p.tabs.value,P),l=G(p.panels.value,P),h=y.filter(T=>{var A;return!((A=P(T))!=null&&A.hasAttribute("disabled"))});if(s<0||s>y.length-1){let T=se(b.value===null?0:Math.sign(s-b.value),{[-1]:()=>1,0:()=>se(Math.sign(s),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0}),A=se(T,{0:()=>y.indexOf(h[0]),1:()=>y.indexOf(h[h.length-1])});A!==-1&&(b.value=A),p.tabs.value=y,p.panels.value=l}else{let T=y.slice(0,s),A=[...y.slice(s),...T].find(B=>h.includes(B));if(!A)return;let C=(v=y.indexOf(A))!=null?v:p.selectedIndex.value;C===-1&&(C=p.selectedIndex.value),b.value=C,p.tabs.value=y,p.panels.value=l}}let p={selectedIndex:k(()=>{var s,v;return(v=(s=b.value)!=null?s:a.defaultIndex)!=null?v:null}),orientation:k(()=>a.vertical?"vertical":"horizontal"),activation:k(()=>a.manual?"manual":"auto"),tabs:n,panels:d,setSelectedIndex(s){c.value!==s&&w("change",s),u.value||o(s)},registerTab(s){var v;if(n.value.includes(s))return;let y=n.value[b.value];if(n.value.push(s),n.value=G(n.value,P),!u.value){let l=(v=n.value.indexOf(y))!=null?v:b.value;l!==-1&&(b.value=l)}},unregisterTab(s){let v=n.value.indexOf(s);v!==-1&&n.value.splice(v,1)},registerPanel(s){d.value.includes(s)||(d.value.push(s),d.value=G(d.value,P))},unregisterPanel(s){let v=d.value.indexOf(s);v!==-1&&d.value.splice(v,1)}};ie(_e,p);let g=E({tabs:[],panels:[]}),U=E(!1);W(()=>{U.value=!0}),ie(ue,k(()=>U.value?null:g.value));let O=k(()=>a.selectedIndex);return W(()=>{fe([O],()=>{var s;return o((s=a.selectedIndex)!=null?s:a.defaultIndex)},{immediate:!0})}),he(()=>{if(!u.value||c.value==null||p.tabs.value.length<=0)return;let s=G(p.tabs.value,P);s.some((v,y)=>P(p.tabs.value[y])!==P(v))&&p.setSelectedIndex(s.findIndex(v=>P(v)===P(p.tabs.value[c.value])))}),()=>{let s={selectedIndex:b.value};return ne(le,[n.value.length<=0&&ne(Me,{onFocus:()=>{for(let v of n.value){let y=P(v);if((y==null?void 0:y.tabIndex)===0)return y.focus(),!0}return!1}}),K({theirProps:{...f,...ke(a,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:s,slots:_,attrs:f,name:"TabGroup"})])}}}),He=V({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:_,slots:f}){let w=Q("TabList");return()=>{let m={selectedIndex:w.selectedIndex.value},b={role:"tablist","aria-orientation":w.orientation.value};return K({ourProps:b,theirProps:a,slot:m,attrs:_,slots:f,name:"TabList"})}}}),te=V({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(a,{attrs:_,slots:f,expose:w}){var m;let b=(m=a.id)!=null?m:`headlessui-tabs-tab-${me()}`,n=Q("Tab"),d=E(null);w({el:d,$el:d}),W(()=>n.registerTab(d)),ye(()=>n.unregisterTab(d));let u=z(ue),c=k(()=>{if(u.value){let l=u.value.tabs.indexOf(b);return l===-1?u.value.tabs.push(b)-1:l}return-1}),o=k(()=>{let l=n.tabs.value.indexOf(d);return l===-1?c.value:l}),p=k(()=>o.value===n.selectedIndex.value);function g(l){var h;let T=l();if(T===J.Success&&n.activation.value==="auto"){let A=(h=Ie(d))==null?void 0:h.activeElement,C=n.tabs.value.findIndex(B=>P(B)===A);C!==-1&&n.setSelectedIndex(C)}return T}function U(l){let h=n.tabs.value.map(T=>P(T)).filter(Boolean);if(l.key===D.Space||l.key===D.Enter){l.preventDefault(),l.stopPropagation(),n.setSelectedIndex(o.value);return}switch(l.key){case D.Home:case D.PageUp:return l.preventDefault(),l.stopPropagation(),g(()=>N(h,$.First));case D.End:case D.PageDown:return l.preventDefault(),l.stopPropagation(),g(()=>N(h,$.Last))}if(g(()=>se(n.orientation.value,{vertical(){return l.key===D.ArrowUp?N(h,$.Previous|$.WrapAround):l.key===D.ArrowDown?N(h,$.Next|$.WrapAround):J.Error},horizontal(){return l.key===D.ArrowLeft?N(h,$.Previous|$.WrapAround):l.key===D.ArrowRight?N(h,$.Next|$.WrapAround):J.Error}}))===J.Success)return l.preventDefault()}let O=E(!1);function s(){var l;O.value||(O.value=!0,!a.disabled&&((l=P(d))==null||l.focus({preventScroll:!0}),n.setSelectedIndex(o.value),Ne(()=>{O.value=!1})))}function v(l){l.preventDefault()}let y=we(k(()=>({as:a.as,type:_.type})),d);return()=>{var l,h;let T={selected:p.value,disabled:(l=a.disabled)!=null?l:!1},{...A}=a,C={ref:d,onKeydown:U,onMousedown:v,onClick:s,id:b,role:"tab",type:y.value,"aria-controls":(h=P(n.panels.value[o.value]))==null?void 0:h.id,"aria-selected":p.value,tabIndex:p.value?0:-1,disabled:a.disabled?!0:void 0};return K({ourProps:C,theirProps:A,slot:T,attrs:_,slots:f,name:"Tab"})}}}),We=V({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:_,attrs:f}){let w=Q("TabPanels");return()=>{let m={selectedIndex:w.selectedIndex.value};return K({theirProps:a,ourProps:{},slot:m,attrs:f,slots:_,name:"TabPanels"})}}}),ae=V({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null},tabIndex:{type:Number,default:0}},setup(a,{attrs:_,slots:f,expose:w}){var m;let b=(m=a.id)!=null?m:`headlessui-tabs-panel-${me()}`,n=Q("TabPanel"),d=E(null);w({el:d,$el:d}),W(()=>n.registerPanel(d)),ye(()=>n.unregisterPanel(d));let u=z(ue),c=k(()=>{if(u.value){let g=u.value.panels.indexOf(b);return g===-1?u.value.panels.push(b)-1:g}return-1}),o=k(()=>{let g=n.panels.value.indexOf(d);return g===-1?c.value:g}),p=k(()=>o.value===n.selectedIndex.value);return()=>{var g;let U={selected:p.value},{tabIndex:O,...s}=a,v={ref:d,id:b,role:"tabpanel","aria-labelledby":(g=P(n.tabs.value[o.value]))==null?void 0:g.id,tabIndex:p.value?O:-1};return!p.value&&a.unmount&&!a.static?ne(xe,{as:"span","aria-hidden":!0,...v}):K({ourProps:v,theirProps:s,slot:U,attrs:_,slots:f,features:ce.Static|ce.RenderStrategy,visible:p.value,name:"TabPanel"})}}});const ze={key:1,class:"page-content pt-3"},Ke={class:"flex items-center justify-between gap-4"},Qe={value:null},Je=["value"],Xe={value:null},Ye=["value"],Ze={class:"text-xs"},et={class:"text-xs"},tt=["onClick"],at=["onClick"],lt=["onClick"],st=["onClick"],ot={__name:"LeasingDashboardView",setup(a){const _=Be(()=>Re(()=>import("./RenewLeaseModal-Dbj4J-lB.js"),__vite__mapDeps([0,1,2,3])));Pe({title:"Lease Dashboard"});const f=E(!1),w=Se(),m=z("eventBus"),b=z("eventSource"),n=Le(),d=Te(),u=Ae(),c=E(null),o=E(null),p=E(0),g=E(null),U=[{key:"buyer",label:"Buyer"},{key:"amount",label:"Amount",sortable:!0},{key:"duration",label:"Duration",sortable:!0},{key:"total_payment",label:"Payment",sortable:!0},{key:"duration",label:"Duration",sortable:!0},{key:"apr",label:"APR",sortable:!0},{key:"expires_at",label:"Expires At",sortable:!0},{key:"actions",label:""}],O=[{key:"delegated_to",label:"Delegated To",sortable:!0},{key:"amount",label:"Amount",sortable:!0},{key:"apr",label:"APR",sortable:!0},{key:"progress",label:"Progress",sortable:!0},{key:"expires_at",label:"Expires At",sortable:!0},{key:"actions",label:""}],s=[{key:"beneficiary",label:"Leasee",sortable:!0},{key:"leased_from",label:"Leased From",sortable:!0},{key:"amount",label:"Amount",sortable:!0},{key:"paid_payment",label:"Paid",sortable:!0},{key:"progress",label:"Progress",sortable:!0},{key:"expires_at",label:"Expires At",sortable:!0},{key:"actions",label:""}],v=[{key:"leasee",label:"Leasee",sortable:!0},{key:"amount",label:"Amount",sortable:!0},{key:"payment_received",label:"Payment Received",sortable:!0},{key:"expired_on",label:"Expired On",sortable:!0},{key:"actions",label:""}],y=k(()=>Array.from(u.assets.keys())),l=k(()=>u.dashboard.delegated.filter(t=>c.value&&o.value?t.asset===c.value&&t.currency===o.value:c.value?t.asset===c.value:o.value?t.currency===o.value:!0).map(t=>({...t,delegated_to:t.beneficiary,progress:H((1-(t.total_payment-t.paid_payment)/t.total_payment)*100,2),expires_at:be(new Date(t.created_at),t.duration)}))),h=k(()=>u.dashboard.leases_in.filter(t=>c.value&&o.value?t.asset===c.value&&t.currency===o.value:c.value?t.asset===c.value:o.value?t.currency===o.value:!0).map(t=>({...t,leased_from:t.filled_by,progress:H((1-(t.total_payment-t.paid_payment)/t.total_payment)*100,2),expires_at:be(new Date(t.created_at),t.duration)}))),T=k(()=>u.dashboard.requests.filter(t=>c.value&&o.value?t.asset===c.value&&t.currency===o.value:c.value?t.asset===c.value:o.value?t.currency===o.value:!0).map(t=>({...t,expires_at:new Date(t.expires_at)}))),A=k(()=>u.dashboard.expired.filter(t=>c.value&&o.value?t.asset===c.value&&t.currency===o.value:c.value?t.asset===c.value:o.value?t.currency===o.value:!0).map(t=>({...t,leasee:t.beneficiary,progress:H((1-(t.total_payment-t.paid_payment)/t.total_payment)*100,2),expired_on:new Date(t.completed_at)}))),C=t=>{p.value=t,c.value=null,o.value=null},B=async({id:t})=>{await w.closeAll(),f.value=!0,await n.validateTransaction(t),f.value=!1},oe=({eventData:t})=>{const{dashboard:F}=u;F&&F.delegated&&(u.dashboard={...u.dashboard,delegated:u.dashboard.delegated.filter(e=>e.id!==t.id)})},ge=async t=>{const{open:F}=Oe({component:_,attrs:{lease:t}});await F()};fe(()=>d.username,async()=>{d.isLoggedIn&&(f.value=!0,await u.fetchUserLeases(),f.value=!1)});let j=null;Ee(g,t=>{t?j&&clearInterval(j):j=setInterval(u.fetchUserLeases,30*1e3)},{throttle:3*1e3}),Fe(async()=>{f.value=!0,await u.fetchUserLeases(),f.value=!1});let q=b.getInstance();return W(()=>{q.addEventListener("open",()=>g.value=!0),q.addEventListener("error",()=>g.value=!1),q.addEventListener("updateDashboard",u.fetchUserLeases),m.on("lease-renew-successful",B),m.on("lease-request-cancel-successful",B),m.on("lease-undelegation-successful",oe)}),Ce(()=>{q.removeEventListener("open",()=>g.value=!0),q.removeEventListener("error",()=>g.value=!1),q.removeEventListener("updateDashboard",u.fetchUserLeases),m.off("lease-renew-successful",B),m.off("lease-request-cancel-successful",B),m.off("lease-undelegation-successful",oe),j&&clearInterval(j)}),(t,F)=>(R(),M(le,null,[F[2]||(F[2]=De('<div class="page-header"><div class="mx-auto w-full max-w-7xl px-2 text-gray-200 sm:px-6 lg:px-8"><div class="grid min-h-[120px] items-center text-center md:grid-cols-4 md:text-left"><div class="col-span-full mt-3 md:col-span-1"><h1 class="text-4xl uppercase">Lease Dashboard</h1></div></div></div></div>',1)),f.value?(R(),$e(Ue,{key:0})):(R(),M("div",ze,[S("div",Ke,[de(S("select",{"onUpdate:modelValue":F[0]||(F[0]=e=>c.value=e),name:"selectedAsset",class:"mb-5 w-[200px]"},[S("option",Qe,i(c.value?"Reset filter":"Filter by asset"),1),(R(!0),M(le,null,pe(y.value,e=>(R(),M("option",{key:e,value:e},i(e),9,Je))),128))],512),[[ve,c.value]]),de(S("select",{"onUpdate:modelValue":F[1]||(F[1]=e=>o.value=e),name:"selectedCurrency",class:"mb-5 w-[200px]"},[S("option",Xe,i(o.value?"Reset filter":"Filter by currency"),1),(R(!0),M(le,null,pe(x(u).currencies,e=>(R(),M("option",{key:e,value:e},i(e),9,Ye))),128))],512),[[ve,o.value]])]),L(x(Ge),{"selected-index":p.value,onChange:C},{default:r(()=>[L(x(He),{class:"flex space-x-4 rounded-md bg-slate-500 p-1 dark:bg-slate-700"},{default:r(()=>[L(x(te),{as:"templete"},{default:r(({selected:e})=>[S("button",{class:X(["btn hover:!bg-red-600 focus:outline-none",e?"!bg-red-600":"!bg-transparent"])}," Requests ",2)]),_:1}),L(x(te),{as:"templete"},{default:r(({selected:e})=>[S("button",{class:X(["btn hover:!bg-red-600 focus:outline-none",e?"!bg-red-600":"!bg-transparent"])}," Delegated (Out) ",2)]),_:1}),L(x(te),{as:"templete"},{default:r(({selected:e})=>[S("button",{class:X(["btn hover:!bg-red-600 focus:outline-none",e?"!bg-red-600":"!bg-transparent"])}," Leased (In) ",2)]),_:1}),L(x(te),{as:"template"},{default:r(({selected:e})=>[S("button",{class:X(["btn hover:!bg-red-600 focus:outline-none",e?"!bg-red-600":"!bg-transparent"])}," Expired Leases ",2)]),_:1})]),_:1}),L(x(We),{class:"mt-3"},{default:r(()=>[L(x(ae),null,{default:r(()=>[L(ee,{items:T.value,fields:U},{"cell(amount)":r(({item:e})=>[I(i(x(Y)(e.asset==="HP"?Number((e.amount*e.vests_price).toFixed(3)):e.amount))+" "+i(e.asset),1)]),"cell(duration)":r(({item:e})=>[I(i(e.duration)+" weeks",1)]),"cell(daily_payment)":r(({item:e})=>[I(i(e.daily_payment)+" ",1),S("span",Ze,i(e.currency),1)]),"cell(total_payment)":r(({item:e})=>[I(i(e.total_payment)+" ",1),S("span",et,i(e.currency),1)]),"cell(apr)":r(({item:e})=>[I(i(x(H)(e.apr,2))+"%",1)]),"cell(expires_at)":r(({item:e})=>[I(i(e.expires_at.toLocaleString()),1)]),"cell(actions)":r(({item:e})=>[S("button",{class:"btn-sm",onClick:Z(re=>x(u).requestCancelLease(e),["prevent"])},"Cancel",8,tt)]),_:1},8,["items"])]),_:1}),L(x(ae),null,{default:r(()=>[L(ee,{items:l.value,fields:O},{"cell(amount)":r(({item:e})=>[I(i(x(Y)(e.asset==="HP"?Number((e.amount*e.vests_price).toFixed(3)):e.amount))+" "+i(e.asset),1)]),"cell(apr)":r(({item:e})=>[I(i(x(H)(e.apr,2))+"%",1)]),"cell(progress)":r(({item:e})=>[I(i(e.progress)+"%",1)]),"cell(expires_at)":r(({item:e})=>[I(i(e.expires_at.toLocaleString()),1)]),"cell(actions)":r(({item:e})=>[S("button",{class:"btn-sm",onClick:Z(re=>x(u).requestUndelegate(e),["prevent"])},"Undelegate",8,at)]),_:1},8,["items"])]),_:1}),L(x(ae),null,{default:r(()=>[L(ee,{items:h.value,fields:s},{"cell(amount)":r(({item:e})=>[I(i(x(Y)(e.asset==="HP"?Number((e.amount*e.vests_price).toFixed(3)):e.amount))+" "+i(e.asset),1)]),"cell(paid_payment)":r(({item:e})=>[I(i(e.paid_payment)+" "+i(e.currency),1)]),"cell(progress)":r(({item:e})=>[I(i(e.progress)+"%",1)]),"cell(expires_at)":r(({item:e})=>[I(i(e.expires_at.toLocaleString()),1)]),"cell(actions)":r(({item:e})=>[S("button",{class:"btn-sm",onClick:Z(re=>ge(e),["prevent"])},"Renew",8,lt)]),_:1},8,["items"])]),_:1}),L(x(ae),null,{default:r(()=>[L(ee,{items:A.value,fields:v},{"cell(amount)":r(({item:e})=>[I(i(x(Y)(e.asset==="HP"?Number((e.amount*e.vests_price).toFixed(3)):e.amount))+" "+i(e.asset),1)]),"cell(payment_received)":r(({item:e})=>[I(i(e.payment_received)+" "+i(e.currency),1)]),"cell(expired_on)":r(({item:e})=>[I(i(e.expired_on.toLocaleString()),1)]),"cell(actions)":r(({item:e})=>[S("button",{class:"btn-sm",onClick:Z(re=>x(u).requestUndelegate(e),["prevent"])},"Undelegate",8,st)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1},8,["selected-index"])]))],64))}};export{ot as default};
