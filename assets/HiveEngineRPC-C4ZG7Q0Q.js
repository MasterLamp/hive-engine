import{u as P,r as m,c as y,o as r,a as w,w as h,b as B,d as i,F as f,e as D,f as a,t as d,g,h as N,i as S,j as $,k as I,v as j,_ as A,E as H,S as L,l as M,m as V}from"./index-CCPLilNe.js";const q=["id","value","checked","disabled"],F=["for"],T={class:"font-bold"},O={key:0,class:"ml-3 text-xs font-bold text-green-600"},U={class:"text-xs"},W={key:0,class:"flex flex-wrap space-x-4 text-sm font-bold"},z={key:0,class:"text-red-600"},G={class:"text-green-600"},J=["disabled","onClick"],K={class:"mb-3"},Q={class:"flex items-center space-x-4"},X=["disabled"],ee={__name:"HiveEngineRPC",setup(Y){const n=P(),o=m(""),c=m(!1),l=m(new Map),_=y(()=>n.hiveEngineRPCs.map(t=>({value:t,text:t.replace("https://",""),checked:n.hiveEngineRPC===t}))),x=t=>{n.hiveEngineRPC=t},k=async()=>{if(c.value=!0,o.value.startsWith("https://")&&!n.hiveEngineRPCs.includes(o.value))try{const t=await b(o.value);l.value.set(o.value,{block:t.data.result.blockNumber,response_time:`${t.response_time}s`}),n.hiveEngineRPCs.push(o.value),o.value=""}catch{H({title:"Error",text:"Invalid Hive-Engine RPC",type:"error"})}c.value=!1},C=t=>{window.confirm("Are you sure?")&&(n.hiveEngineRPCs=n.hiveEngineRPCs.filter(s=>s!==t))},R=async()=>{n.hiveEngineRPC=L,n.hiveEngineRPCs=M,await u()},b=async t=>{const s=V.create({baseURL:`${t}`});return s.interceptors.request.use(e=>({...e,request_timestamp:Date.now()}),e=>Promise.reject(e)),s.interceptors.response.use(e=>{const v=Date.now()-e.config.request_timestamp;return{...e,rpc:t,response_time:(v/1e3).toFixed(1)}},e=>Promise.reject({...e,rpc:t})),s.post("blockchain",{jsonrpc:"2.0",id:Date.now(),method:"getLatestBlockInfo"})},u=async()=>{const t=n.hiveEngineRPCs.map(e=>b(e));let s=await Promise.allSettled(t);s=s.map(e=>e.status==="fulfilled"?[e.value.rpc,{block:e.value.data.result.blockNumber,response_time:`${e.value.response_time}s`}]:[e.reason.rpc,"Error"]),l.value=new Map(s)},E=async()=>{await u()};return(t,s)=>(r(),w(A,{"modal-id":"hiveEngineRpcModal",onBeforeOpen:E},{title:h(()=>s[2]||(s[2]=[B("Hive-Engine RPC")])),default:h(()=>[(r(!0),i(f,null,D(_.value,(e,v)=>(r(),i("div",{key:`${v}-${e.text}`,class:"mb-3 flex items-center space-x-4 border-b pb-2 last-of-type:border-b-0 dark:border-gray-500"},[a("input",{id:e.text,class:"h-4 w-4 border border-gray-300 text-red-600 focus:ring-2 focus:ring-red-500 disabled:cursor-not-allowed disabled:bg-gray-300 dark:focus:ring-red-600",name:"hive-engine-rpc",type:"radio",value:e.value,checked:e.checked,disabled:l.value.get(e.value)==="Error",onChange:s[0]||(s[0]=p=>x(p.target.value))},null,40,q),a("label",{class:"block grow",for:e.text},[a("div",null,[a("span",T,d(e.text),1),e.text==="enginerpc.com"||e.text==="ha.herpc.dtools.dev"?(r(),i("span",O,"LB")):g("",!0)]),a("div",U,d(e.value),1)],8,F),l.value.get(e.value)?(r(),i("div",W,[l.value.get(e.value)==="Error"?(r(),i("div",z,"Error")):(r(),i(f,{key:1},[a("div",null,d(l.value.get(e.value).block),1),a("div",G,d(l.value.get(e.value).response_time),1)],64))])):g("",!0),a("button",{disabled:e.checked,class:"btn-sm disabled:text-red-300",onClick:p=>C(e.value)},[N(S($),{class:"h-4 w-4"})],8,J)]))),128)),a("div",{class:"mb-5 flex items-center justify-between space-x-4"},[a("button",{class:"btn-outline-sm dark:btn-sm",onClick:R},"Restore Defaults"),a("button",{class:"btn-outline-sm dark:btn-sm",onClick:u},"Refresh")]),a("div",K,[s[3]||(s[3]=a("label",{for:"rpc",class:"mb-1 block"},"Add another RPC",-1)),a("div",Q,[I(a("input",{id:"rpc","onUpdate:modelValue":s[1]||(s[1]=e=>o.value=e),type:"text",placeholder:"https://"},null,512),[[j,o.value,void 0,{trim:!0}]]),a("button",{class:"btn",disabled:c.value,onClick:k},"Add",8,X)])])]),_:1}))}};export{ee as default};
