const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RequestLease-DGreOsOa.js","assets/index-CCPLilNe.js","assets/index-Rzzs60cW.css","assets/LoadingOverlay-CxOz52n3.js"])))=>i.map(i=>d[i]);
import{U,K as j,u as $,ba as H,x as G,r as x,c as w,bb as K,V as O,G as z,H as J,d as n,f as s,i as r,F as f,h as q,w as i,a as Q,k as R,b8 as h,e as C,n as S,a2 as W,I as A,o as a,b as c,t as o,a6 as X,y as Y,a3 as Z,a4 as ee}from"./index-CCPLilNe.js";import{_ as te}from"./CustomTable-ruclgATk.js";const se={class:"page-header"},ae={class:"mx-auto w-full max-w-7xl px-2 text-gray-200 sm:px-6 lg:px-8"},ne={class:"grid min-h-[120px] items-center text-center md:grid-cols-4 md:text-left"},le={class:"col-span-full mt-3 md:col-span-3"},oe={class:"flex flex-wrap items-center justify-center gap-4 md:justify-end"},re={key:1,class:"page-content pt-3"},ue={class:"flex items-center justify-between gap-4"},ce=["value"],ie=["value"],de={class:"text-xs"},ve={class:"text-xs"},pe=["disabled","onClick"],_e={__name:"LeaseView",setup(fe){const B=Z(()=>ee(()=>import("./RequestLease-DGreOsOa.js"),__vite__mapDeps([0,1,2,3])));U({title:"Lease"});const g=j(),E=$(),u=H(),k=G(),b=S("eventBus"),I=S("eventSource"),m=x(!1),D=[{key:"beneficiary",label:"Lessee"},{key:"amount",label:"Amount",sortable:!0},{key:"duration",label:"Duration",sortable:!0},{key:"daily_payment",label:"Daily Payment",sortable:!0},{key:"total_payment",label:"Total Payment",sortable:!0},{key:"apr",label:"APR",sortable:!0},{key:"action",label:""}],d=x(null),v=x(null),y=x(null),F=w(()=>Array.from(u.assets.keys())),M=w(()=>u.requests.filter(l=>d.value&&v.value?l.asset===d.value&&l.currency===v.value:d.value?l.asset===d.value:v.value?l.currency===v.value:!0)),L=async({id:l})=>{await g.closeAll(),m.value=!0,await E.validateTransaction(l),m.value=!1},V=async()=>{const{open:l}=W({component:B});await l()};let _=null;K(y,l=>{l?_&&clearInterval(_):_=setInterval(u.fetchLeaseRequests,10*1e3)},{throttle:3*1e3});let p=I.getInstance();return O(async()=>{m.value=!0,await u.fetchLeaseRequests(),m.value=!1}),z(()=>{p.addEventListener("open",()=>y.value=!0),p.addEventListener("error",()=>y.value=!1),p.addEventListener("updateRequests",u.fetchLeaseRequests),b.on("lease-request-successful",L),b.on("lease-request-cancel-successful",L)}),J(()=>{p.removeEventListener("open",()=>y.value=!0),p.removeEventListener("error",()=>y.value=!1),p.removeEventListener("updateRequests",u.fetchLeaseRequests),b.off("lease-request-successful",L),b.off("lease-request-cancel-successful",L),_&&clearInterval(_)}),(l,t)=>{const P=A("RouterLink"),N=A("Loading");return a(),n(f,null,[s("div",se,[s("div",ae,[s("div",ne,[t[5]||(t[5]=s("div",{class:"col-span-full mt-3 md:col-span-1"},[s("h1",{class:"text-4xl uppercase"},"Lease Market")],-1)),s("div",le,[s("div",oe,[r(k).isLoggedIn?(a(),n(f,{key:0},[s("button",{class:"btn",onClick:V},"Request a Lease"),q(P,{class:"btn",to:{name:"leasing-dashboard",params:{account:r(k).username}}},{default:i(()=>t[4]||(t[4]=[c("Dashboard")])),_:1},8,["to"])],64)):(a(),n("button",{key:1,class:"btn",onClick:t[0]||(t[0]=e=>r(g).open("loginModal"))},"Login to Request"))])])])])]),m.value?(a(),Q(N,{key:0})):(a(),n("div",re,[s("div",ue,[R(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),name:"selectedAsset",class:"mb-5 w-[200px]"},[t[6]||(t[6]=s("option",{value:null},"Filter by asset",-1)),(a(!0),n(f,null,C(F.value,e=>(a(),n("option",{key:e,value:e},o(e),9,ce))),128))],512),[[h,d.value]]),R(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),name:"selectedCurrency",class:"mb-5 w-[200px]"},[t[7]||(t[7]=s("option",{value:null},"Filter by currency",-1)),(a(!0),n(f,null,C(r(u).currencies,e=>(a(),n("option",{key:e,value:e},o(e),9,ie))),128))],512),[[h,v.value]])]),q(te,{items:M.value,fields:D,"per-page":15},{"cell(amount)":i(({item:e})=>[c(o(r(X)(e.asset==="HP"?Number((e.amount*e.vests_price).toFixed(3)):e.amount))+" "+o(e.asset),1)]),"cell(duration)":i(({item:e})=>[c(o(e.duration)+" weeks",1)]),"cell(daily_payment)":i(({item:e})=>[c(o(e.daily_payment)+" ",1),s("span",de,o(e.currency),1)]),"cell(total_payment)":i(({item:e})=>[c(o(e.total_payment)+" ",1),s("span",ve,o(e.currency),1)]),"cell(apr)":i(({item:e})=>[c(o(r(Y)(e.apr,2))+"%",1)]),"cell(action)":i(({item:e})=>[r(k).isLoggedIn?(a(),n("button",{key:0,disabled:e.beneficiary===r(k).username||e.locked&&e.unlocks_at>new Date,class:"btn py-1",onClick:T=>r(u).fillLeaseRequest(e.id)},[!e.locked||e.locked&&e.unlocks_at<=new Date?(a(),n(f,{key:0},[c("Fill")],64)):(a(),n(f,{key:1},[c(" Available "+o(e.unlock_time_remaining),1)],64))],8,pe)):(a(),n("button",{key:1,class:"btn py-1",onClick:t[3]||(t[3]=T=>r(g).open("loginModal"))},"Login"))]),_:1},8,["items"])]))],64)}}};export{_e as default};
